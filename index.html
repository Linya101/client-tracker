<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OG Client Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050608;
      --bg-soft: #0b0f16;
      --card: #111520;
      --card-soft: #141827;
      --text: #f9fafb;
      --muted: #9ca3af;
      --gold: #d4af37;
      --gold-soft: #3b2a0b;
      --danger: #f97373;
      --border: #1f2933;
      --shadow: 0 18px 45px rgba(0, 0, 0, 0.75);
    }
* { box-sizing: border-box; }

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
    sans-serif;
  background:
    radial-gradient(circle at top, #1f2937 0, #020308 60%);
  color: var(--text);
}

.app-shell {
  max-width: 1240px;
  margin: 0 auto;
  padding: 20px 16px 40px;
}

header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  margin-bottom: 18px;
}

.brand {
  display: flex;
  align-items: center;
  gap: 14px;
}

/* ==== LOGO FRAME ==== */
.logo-frame {
  position: relative;
  width: 72px;
  height: 72px;
  border-radius: 999px;
  background:
    radial-gradient(circle at 20% 10%, #fbe9a7, #d4af37 40%, #3b2a0b 75%);
  box-shadow:
    0 0 0 2px #000,
    0 0 16px rgba(0,0,0,.8),
    0 0 38px rgba(212,175,55,.45);
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: visible;
}

.logo-frame::before {
  content: "";
  position: absolute;
  inset: 6px;
  border-radius: inherit;
  border: 1px solid rgba(15,23,42,0.85);
  box-shadow: inset 0 0 18px rgba(0,0,0,.7);
}

.logo-ring {
  position: relative;
  width: 56px;
  height: 56px;
  border-radius: 999px;
  overflow: hidden;
  border: 2px solid rgba(249,250,251,.1);
  background: radial-gradient(circle at 20% 20%, #facc6b, #8b5a14);
  display: flex;
  align-items: center;
  justify-content: center;
}

.logo-ring img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.brand-title {
  font-size: 22px;
  font-weight: 600;
  letter-spacing: 0.08em;
  text-transform: uppercase;
}

.brand-sub {
  font-size: 12px;
  color: var(--muted);
}

.top-meta {
  text-align: right;
  font-size: 12px;
  color: var(--muted);
}
.top-meta span { display: block; }

.tag {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 3px 10px;
  border-radius: 999px;
  background: rgba(212, 175, 55, 0.1);
  border: 1px solid rgba(212, 175, 55, 0.5);
  color: var(--gold);
  font-size: 11px;
}

.layout {
  display: grid;
  grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.5fr);
  gap: 18px;
}

.card {
  background: radial-gradient(circle at top left, #1f2937, #05070c);
  border-radius: 18px;
  border: 1px solid var(--border);
  box-shadow: var(--shadow);
  padding: 16px 16px 18px;
}

.card-title {
  font-size: 14px;
  font-weight: 600;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--muted);
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}
.card-title span { color: var(--gold); }

form {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px 14px;
}

label {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--muted);
  display: block;
  margin-bottom: 3px;
}

input, select, textarea {
  width: 100%;
  background: var(--bg-soft);
  border-radius: 10px;
  border: 1px solid var(--border);
  padding: 7px 9px;
  color: var(--text);
  font-size: 13px;
  outline: none;
}
input:focus, select:focus, textarea:focus {
  border-color: var(--gold);
  box-shadow: 0 0 0 1px rgba(212, 175, 55, 0.3);
}
textarea {
  resize: vertical;
  min-height: 52px;
}

.full-row { grid-column: 1 / 3; }

.inline {
  display: flex;
  gap: 8px;
}
.inline > * { flex: 1; }

.form-footer {
  grid-column: 1 / 3;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
  margin-top: 4px;
  flex-wrap: wrap;
}

.hint {
  font-size: 11px;
  color: var(--muted);
}

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 7px 16px;
  border-radius: 999px;
  border: 1px solid transparent;
  font-size: 13px;
  cursor: pointer;
  background: linear-gradient(90deg, #facc6b, #e5b035);
  color: #111;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.08em;
}
.btn-secondary {
  background: transparent;
  border-color: var(--gold-soft);
  color: var(--gold);
  padding-inline: 12px;
  font-size: 11px;
}
.btn-small {
  padding: 4px 10px;
  font-size: 11px;
}
.btn:disabled { opacity: 0.6; cursor: default; }

.search-bar {
  display: flex;
  gap: 8px;
  margin-bottom: 10px;
  align-items: center;
  flex-wrap: wrap;
}
.search-bar input { flex: 1; }
.search-bar select { max-width: 150px; }

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 12px;
}
th, td {
  padding: 6px 6px;
  text-align: left;
  border-bottom: 1px solid var(--border);
}
th {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--muted);
  background: linear-gradient(to right, #05070c, #101524);
  position: sticky;
  top: 0;
  z-index: 1;
}
tbody tr:nth-child(even) { background: rgba(15, 23, 42, 0.6); }
tbody tr:hover { background: rgba(212, 175, 55, 0.04); }

.id-pill {
  font-family: ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 11px;
  padding: 2px 6px;
  border-radius: 999px;
  background: rgba(15, 23, 42, 0.9);
  border: 1px solid var(--border);
  display: inline-block;
}

.rating {
  display: inline-flex;
  gap: 1px;
  cursor: pointer;
}
.rating span {
  font-size: 13px;
  color: #4b5563;
  transition: transform 0.1s ease, color 0.1s ease;
}
.rating span.active {
  color: var(--gold);
  transform: translateY(-1px);
}

.small { font-size: 11px; color: var(--muted); }

.actions {
  display: flex;
  gap: 4px;
  flex-wrap: wrap;
}
.chip {
  font-size: 10px;
  padding: 2px 6px;
  border-radius: 999px;
  background: rgba(148, 163, 184, 0.12);
  color: var(--muted);
}

.contacted-toggle {
  border-radius: 999px;
  border: 1px solid var(--gold-soft);
  background: transparent;
  color: var(--gold);
  padding: 2px 8px;
  font-size: 11px;
  cursor: pointer;
}
.contacted-toggle.active {
  background: rgba(34, 197, 94, 0.15);
  border-color: rgba(34, 197, 94, 0.7);
  color: #bbf7d0;
}

.photo-thumb {
  width: 34px;
  height: 34px;
  border-radius: 999px;
  object-fit: cover;
  border: 1px solid var(--border);
}

/* ==== LOGIN OVERLAY WITH FRAME ==== */
.login-overlay {
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at top, #111827, #020308 70%);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 50;
}
.login-card {
  background:
    radial-gradient(circle at top, #1f2937, #020308 80%);
  border-radius: 22px;
  padding: 22px 22px 20px;
  width: 320px;
  border: 1px solid rgba(212,175,55,0.35);
  box-shadow: var(--shadow);
  text-align: center;
  position: relative;
  overflow: hidden;
}
.login-card::before {
  content:"";
  position:absolute;
  inset:-1px;
  border-radius:inherit;
  background: conic-gradient(
    from 160deg,
    rgba(250,204,21,.0),
    rgba(250,204,21,.4),
    rgba(251,191,36,.0) 40%,
    rgba(250,204,21,.0) 70%,
    rgba(250,204,21,.4),
    rgba(250,204,21,.0)
  );
  opacity:.6;
  mix-blend-mode: screen;
  pointer-events:none;
}
.login-inner {
  position:relative;
  z-index:1;
}

.login-logo-frame {
  margin: 0 auto 10px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.login-title {
  font-size: 18px;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  margin-bottom: 4px;
}
.login-sub {
  font-size: 12px;
  color: var(--muted);
  margin-bottom: 12px;
}
.login-card label {
  text-align: left;
  margin-bottom: 2px;
}
.login-card input { background: var(--bg-soft); }
.login-error {
  font-size: 11px;
  color: var(--danger);
  min-height: 14px;
  margin-top: 4px;
  text-align: left;
}

/* ==== GOLD CLIENT CARD OVERLAY ==== */
.card-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 60;
  padding: 16px;
}
.card-overlay-inner {
  background: #050607;
  border-radius: 18px;
  border: 1px solid rgba(212,175,55,0.5);
  max-width: 420px;
  width: 100%;
  padding: 16px;
  box-shadow: var(--shadow);
}
.gold-card {
  background: radial-gradient(circle at top, #1f2937 0, #020308 70%);
  border-radius: 16px;
  padding: 14px 14px 12px;
  border: 1px solid rgba(212,175,55,0.7);
  color: #f9fafb;
}
.gold-card-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}
.gold-card-id {
  font-family: ui-monospace, Menlo, Monaco, Consolas;
  font-size: 12px;
  padding: 2px 8px;
  border-radius: 999px;
  border: 1px solid rgba(212,175,55,0.7);
  background: rgba(0,0,0,0.4);
}
.gold-card-name {
  font-size: 18px;
  font-weight: 600;
}
.gold-card-sub {
  font-size: 12px;
  color: var(--muted);
}
.gold-mini-logo {
  width: 40px;
  height: 40px;
  border-radius: 999px;
  background: radial-gradient(circle at 20% 20%, #facc6b, #8b5a14);
  border: 1px solid rgba(249,250,251,.5);
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}
.gold-mini-logo img {
  width:100%;
  height:100%;
  object-fit:contain;
}
.gold-grid {
  display:grid;
  grid-template-columns: repeat(2,minmax(0,1fr));
  gap:4px 10px;
  margin-top:6px;
  font-size:12px;
}
.gold-label {
  text-transform:uppercase;
  letter-spacing:.08em;
  font-size:10px;
  color:var(--muted);
}
.gold-section {
  margin-top:8px;
  font-size:12px;
}
.gold-section-title {
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:.08em;
  color:var(--muted);
  margin-bottom:2px;
}
.card-overlay-actions {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:10px;
  gap:10px;
  flex-wrap:wrap;
}

@media (max-width: 920px) {
  .layout { grid-template-columns: 1fr; }
}
@media (max-width: 640px) {
  header { flex-direction: column; align-items: flex-start; }
  .top-meta { text-align: left; }
}

  </style>
</head>
<body>
  <!-- LOGIN SCREEN -->
  <div class="login-overlay" id="loginOverlay">
    <div class="login-card">
      <div class="login-inner">
        <div class="login-logo-frame">
          <div class="logo-frame">
            <div class="logo-ring">
              <!-- Make sure og-logo.png is uploaded next to index.html -->
              <img src="og-logo.png" alt="OG Logo" />
            </div>
          </div>
        </div>
        <div class="login-title">OG 集团</div>
        <div class="login-sub">Internal client hub – staff only</div>
    <div style="text-align:left;margin-bottom:10px;">
      <label for="loginUser">User name</label>
      <input id="loginUser" name="loginUser" type="text" placeholder="ogadmin" />
    </div>
    <div style="text-align:left;">
      <label for="loginPass">Password</label>
      <input id="loginPass" name="loginPass" type="password" placeholder="••••••••" />
    </div>
    <div class="login-error" id="loginError"></div>
    <button class="btn" id="loginBtn" style="width:100%; margin-top:6px;">
      Enter
    </button>
    <div class="small" style="margin-top:8px; opacity:0.7;">
      Default login: <b>ogadmin / og2025</b>.
    </div>
  </div>
</div>

  </div>
  <!-- GOLD CLIENT CARD OVERLAY -->
  <div class="card-overlay" id="clientCardOverlay">
    <div class="card-overlay-inner">
      <div id="clientCardContainer" class="gold-card"></div>
      <div class="card-overlay-actions">
        <button class="btn btn-small" id="printCardBtn">Download / Print card</button>
        <button class="btn-secondary btn-small" id="closeCardBtn">Close</button>
      </div>
    </div>
  </div>
  <div class="app-shell" id="appShell" style="opacity:0.1; pointer-events:none;">
    <header>
      <div class="brand">
        <div class="logo-frame">
          <div class="logo-ring">
            <img src="og-logo.png" alt="OG Logo" />
          </div>
        </div>
        <div>
          <div class="brand-title">OG 集团</div>
          <div class="brand-sub">Client Intelligence · Asia Desk</div>
        </div>
      </div>
      <div class="top-meta">
        <span class="tag">Private · Local only · Saved in this browser</span>
        <span id="clientCountMeta">0 clients saved</span>
        <span>
          <button id="exportBtn" class="btn-secondary btn-small">Export CSV</button>
        </span>
      </div>
    </header>
<div class="layout">
  <!-- FORM CARD -->
  <section class="card">
    <div class="card-title">
      <span>New client intake</span>
      <button type="button" class="btn-secondary" id="clearFormBtn">
        Clear form
      </button>
    </div>

    <form id="clientForm">
      <div>
        <label>Client name</label>
        <input id="clientName" name="clientName" type="text" required />
      </div>

      <div>
        <label>Age</label>
        <input id="clientAge" name="clientAge" type="number" min="18" max="120" />
      </div>

      <div>
        <label>State (USA)</label>
        <select id="clientState" name="clientState">
          <option value="">Select…</option>
          <option>Alabama</option><option>Alaska</option><option>Arizona</option>
          <option>Arkansas</option><option>California</option><option>Colorado</option>
          <option>Connecticut</option><option>Delaware</option><option>District of Columbia</option>
          <option>Florida</option><option>Georgia</option><option>Hawaii</option>
          <option>Idaho</option><option>Illinois</option><option>Indiana</option>
          <option>Iowa</option><option>Kansas</option><option>Kentucky</option>
          <option>Louisiana</option><option>Maine</option><option>Maryland</option>
          <option>Massachusetts</option><option>Michigan</option><option>Minnesota</option>
          <option>Mississippi</option><option>Missouri</option><option>Montana</option>
          <option>Nebraska</option><option>Nevada</option><option>New Hampshire</option>
          <option>New Jersey</option><option>New Mexico</option><option>New York</option>
          <option>North Carolina</option><option>North Dakota</option><option>Ohio</option>
          <option>Oklahoma</option><option>Oregon</option><option>Pennsylvania</option>
          <option>Rhode Island</option><option>South Carolina</option><option>South Dakota</option>
          <option>Tennessee</option><option>Texas</option><option>Utah</option>
          <option>Vermont</option><option>Virginia</option><option>Washington</option>
          <option>West Virginia</option><option>Wisconsin</option><option>Wyoming</option>
        </select>
      </div>

      <div>
        <label>City</label>
        <input id="clientCity" name="clientCity" type="text" placeholder="City in that state" />
      </div>

      <div>
        <label>Relationship status</label>
        <select id="relationshipStatus" name="relationshipStatus">
          <option value="">Select…</option>
          <option>Single</option>
          <option>Married</option>
          <option>Divorced</option>
          <option>Widowed</option>
          <option>In a relationship</option>
          <option>Complicated</option>
        </select>
      </div>

      <div>
        <label>Looking for</label>
        <select id="lookingFor" name="lookingFor">
          <option value="">Select…</option>
          <option>Friend only</option>
          <option>Relationship</option>
          <option>Both friend & relationship</option>
          <option>Not sure</option>
        </select>
      </div>

      <div>
        <label>Work status</label>
        <select id="workStatus" name="workStatus">
          <option value="">Select…</option>
          <option value="working">Working</option>
          <option value="retired">Retired</option>
        </select>
      </div>

      <div>
        <label id="workStatusLabel">Job / Retired from</label>
        <input id="jobInfo" name="jobInfo" type="text" placeholder="Example: IT manager / retired police" />
      </div>

      <div>
        <label>Chat with Asian girl before?</label>
        <select id="asianExperience" name="asianExperience">
          <option value="">Select…</option>
          <option value="never">Never</option>
          <option value="yes">Yes, before</option>
        </select>
      </div>

      <div>
        <label>Crypto view</label>
        <input id="cryptoView" name="cryptoView" type="text" placeholder="Bullish / curious / doesn’t trust, etc." />
      </div>

      <div class="inline">
        <div>
          <label>Work start time</label>
          <input id="workStart" name="workStart" type="time" />
        </div>
        <div>
          <label>Work finish time</label>
          <input id="workEnd" name="workEnd" type="time" />
        </div>
      </div>

      <div>
        <label>Hobby / free time</label>
        <input id="hobbies" name="hobbies" type="text" placeholder="Gym, golf, Netflix, travel…" />
      </div>

      <div>
        <label>Appearance notes (optional)</label>
        <input id="appearance" name="appearance" type="text" placeholder="Tall, beard, glasses, etc." />
      </div>

      <div>
        <label>Contact app</label>
        <select id="contactApp" name="contactApp">
          <option value="">Select…</option>
          <option>Telegram</option>
          <option>WhatsApp</option>
          <option>LINE</option>
          <option>WeChat</option>
          <option>Discord</option>
          <option>Facebook</option>
          <option>Instagram</option>
          <option>Phone / SMS</option>
          <option>Other</option>
        </select>
      </div>

      <div>
        <label>Contact ID / link</label>
        <input id="contactHandle" name="contactHandle" type="text" placeholder="@username / phone / link" />
      </div>

      <div>
        <label>App he came from</label>
        <select id="sourceApp" name="sourceApp">
          <option value="">Select…</option>
          <option>Facebook</option>
          <option>TikTok</option>
          <option>Instagram</option>
          <option>Tantan</option>
          <option>Meeff</option>
          <option>Paltalk</option>
          <option>Bingo Live</option>
          <option>Bluesky</option>
          <option>Other</option>
        </select>
      </div>

      <div>
        <label>Photo</label>
        <input id="photo" name="photo" type="file" accept="image/*" />
      </div>

      <div class="full-row">
        <label>Notes (internal)</label>
        <textarea id="notes" name="notes" placeholder="Impression, red flags, money level, family info, etc."></textarea>
      </div>

      <div class="form-footer">
        <div class="hint">
          Save will auto assign ID (0001, 0002, …) and push into client list.
        </div>
        <button type="submit" class="btn" id="saveBtn">
          Save client
        </button>
      </div>
    </form>
  </section>

  <!-- LIST CARD -->
  <section class="card" style="overflow:hidden; display:flex; flex-direction:column;">
    <div class="card-title">
      <span>Client list</span>
      <span id="lastSavedLabel" class="small"></span>
    </div>

    <div class="search-bar">
      <input
        id="searchInput"
        type="text"
        placeholder="Search by name, state, city, contact, app, hobby, crypto view…"
      />
      <select id="filterApp">
        <option value="">All apps</option>
        <option>Facebook</option>
        <option>TikTok</option>
        <option>Instagram</option>
        <option>Tantan</option>
        <option>Meeff</option>
        <option>Paltalk</option>
        <option>Bingo Live</option>
        <option>Bluesky</option>
        <option>Other</option>
      </select>
      <select id="filterContact">
        <option value="">All</option>
        <option value="pending">Pending</option>
        <option value="contacted">Contacted</option>
      </select>
      <select id="filterRating">
        <option value="">Any rating</option>
        <option value="3">★ 3+</option>
        <option value="4">★ 4+</option>
        <option value="5">★ 5 only</option>
      </select>
    </div>

    <div style="flex:1; overflow:auto; max-height:520px;">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Client</th>
            <th>Profile</th>
            <th>Contact</th>
            <th>From app</th>
            <th>Contacted</th>
            <th>Rating</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="clientTableBody"></tbody>
      </table>
    </div>
  </section>
</div>

  </div>
  <script>
    const STORAGE_KEY = "og_clients_v3";
    const COUNTER_KEY = "og_client_counter_v3";
    const LOGIN_FLAG = "og_logged_in_v1";

    let clients = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    let counter = parseInt(localStorage.getItem(COUNTER_KEY) || "0", 10);
    let editingId = null;
    let currentCardClient = null;

    const loginOverlay = document.getElementById("loginOverlay");
    const loginUser = document.getElementById("loginUser");
    const loginPass = document.getElementById("loginPass");
    const loginBtn = document.getElementById("loginBtn");
    const loginError = document.getElementById("loginError");
    const appShell = document.getElementById("appShell");

    const clientForm = document.getElementById("clientForm");
    const clearFormBtn = document.getElementById("clearFormBtn");
    const searchInput = document.getElementById("searchInput");
    const filterApp = document.getElementById("filterApp");
    const filterContact = document.getElementById("filterContact");
    const filterRating = document.getElementById("filterRating");
    const clientTableBody = document.getElementById("clientTableBody");
    const clientCountMeta = document.getElementById("clientCountMeta");
    const lastSavedLabel = document.getElementById("lastSavedLabel");
    const workStatusSelect = document.getElementById("workStatus");
    const workStatusLabel = document.getElementById("workStatusLabel");
    const photoInput = document.getElementById("photo");
    const exportBtn = document.getElementById("exportBtn");

    const cardOverlay = document.getElementById("clientCardOverlay");
    const cardContainer = document.getElementById("clientCardContainer");
    const closeCardBtn = document.getElementById("closeCardBtn");
    const printCardBtn = document.getElementById("printCardBtn");

    function unlockIfLogged() {
      if (localStorage.getItem(LOGIN_FLAG) === "1") {
        loginOverlay.style.display = "none";
        appShell.style.opacity = "1";
        appShell.style.pointerEvents = "auto";
      }
    }

    function handleLogin() {
      const u = loginUser.value.trim();
      const p = loginPass.value.trim();
      if (u === "ogadmin" && p === "og2025") {
        localStorage.setItem(LOGIN_FLAG, "1");
        loginError.textContent = "";
        unlockIfLogged();
      } else {
        loginError.textContent = "Wrong username or password.";
      }
    }

    loginBtn.addEventListener("click", handleLogin);
    loginPass.addEventListener("keydown", (e) => {
      if (e.key === "Enter") handleLogin();
    });

    unlockIfLogged();

    function saveAll() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(clients));
      localStorage.setItem(COUNTER_KEY, String(counter));
      clientCountMeta.textContent = clients.length + " clients saved";
    }

    function formatId(num) {
      return String(num).padStart(4, "0");
    }

    function findClient(id) {
      return clients.find((c) => c.id === id);
    }

    function updateLastSaved() {
      if (!clients.length) {
        lastSavedLabel.textContent = "";
        return;
      }
      const latest = clients
        .slice()
        .sort((a, b) => (a.savedAt || 0) - (b.savedAt || 0))
        .at(-1);
      const d = new Date(latest.savedAt || Date.now());
      lastSavedLabel.textContent =
        "Last saved: " +
        d.toLocaleDateString() +
        " " +
        d.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
    }

    workStatusSelect.addEventListener("change", () => {
      const val = workStatusSelect.value;
      if (val === "retired") {
        workStatusLabel.textContent = "Retired from";
      } else if (val === "working") {
        workStatusLabel.textContent = "Current job";
      } else {
        workStatusLabel.textContent = "Job / Retired from";
      }
    });

    clearFormBtn.addEventListener("click", () => {
      clientForm.reset();
      editingId = null;
    });

    clientForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const formData = new FormData(clientForm);
      const obj = Object.fromEntries(formData.entries());

      const clientData = {
        id: editingId || ++counter,
        code: editingId ? findClient(editingId).code : formatId(counter),
        name: obj.clientName || "",
        age: obj.clientAge || "",
        state: obj.clientState || "",
        city: obj.clientCity || "",
        relationshipStatus: obj.relationshipStatus || "",
        lookingFor: obj.lookingFor || "",
        workStatus: obj.workStatus || "",
        jobInfo: obj.jobInfo || "",
        asianExperience: obj.asianExperience || "",
        cryptoView: obj.cryptoView || "",
        workStart: obj.workStart || "",
        workEnd: obj.workEnd || "",
        hobbies: obj.hobbies || "",
        appearance: obj.appearance || "",
        contactApp: obj.contactApp || "",
        contactHandle: obj.contactHandle || "",
        sourceApp: obj.sourceApp || "",
        notes: obj.notes || "",
        contacted: editingId ? findClient(editingId).contacted : false,
        rating: editingId ? findClient(editingId).rating : 0,
        photo: editingId ? findClient(editingId).photo : "",
        savedAt: Date.now(),
      };

      const file = photoInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (evt) => {
          clientData.photo = evt.target.result || "";
          persistClient(clientData);
        };
        reader.readAsDataURL(file);
      } else {
        persistClient(clientData);
      }
    });

    function persistClient(clientData) {
      if (editingId) {
        const idx = clients.findIndex((c) => c.id === editingId);
        if (idx !== -1) clients[idx] = clientData;
      } else {
        clients.push(clientData);
      }
      editingId = null;
      clientForm.reset();
      photoInput.value = "";
      saveAll();
      renderTable();
      updateLastSaved();
    }

    function createCardHTML(c) {
      const locationLine =
        (c.city || "") || (c.state || "")
          ? `${c.city ? c.city : ""}${c.city && c.state ? ", " : ""}${c.state ? c.state : ""}`
          : "";
      const ratingStars = "★★★★★".split("").map((s, i) =>
        `<span style="color:${i < (c.rating || 0) ? '#d4af37' : '#4b5563'};">★</span>`
      ).join("");

      return `
        <div class="gold-card-header">
          <div>
            <div class="gold-card-name">${c.name || "-"}</div>
            <div class="gold-card-sub">${locationLine || "United States"}</div>
          </div>
          <div class="gold-mini-logo">
            <img src="og-logo.png" alt="OG" />
          </div>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
          <div class="gold-card-id">OG-${c.code}</div>
          <div style="font-size:11px;">Rating: ${ratingStars}</div>
        </div>
        <div class="gold-grid">
          <div>
            <div class="gold-label">Age</div>
            <div>${c.age || "-"}</div>
          </div>
          <div>
            <div class="gold-label">Relationship</div>
            <div>${c.relationshipStatus || "-"}</div>
          </div>
          <div>
            <div class="gold-label">Looking for</div>
            <div>${c.lookingFor || "-"}</div>
          </div>
          <div>
            <div class="gold-label">Work status</div>
            <div>${(c.workStatus || "") + (c.jobInfo ? " · " + c.jobInfo : "") || "-"}</div>
          </div>
          <div>
            <div class="gold-label">Crypto view</div>
            <div>${c.cryptoView || "-"}</div>
          </div>
          <div>
            <div class="gold-label">Asia chat</div>
            <div>${
              c.asianExperience === "never" ? "Never" :
              c.asianExperience === "yes" ? "Yes" : "-"
            }</div>
          </div>
          <div>
            <div class="gold-label">Work time</div>
            <div>${(c.workStart || "?") + " - " + (c.workEnd || "?")}</div>
          </div>
          <div>
            <div class="gold-label">Hobby</div>
            <div>${c.hobbies || "-"}</div>
          </div>
        </div>
        <div class="gold-section">
          <div class="gold-section-title">Contact</div>
          <div>${c.contactApp || "-"} · ${c.contactHandle || ""}</div>
        </div>
        <div class="gold-section">
          <div class="gold-section-title">Appearance</div>
          <div>${c.appearance || "-"}</div>
        </div>
        <div class="gold-section">
          <div class="gold-section-title">Notes</div>
          <div>${c.notes || "-"}</div>
        </div>
      `;
    }

    function openCard(c) {
      currentCardClient = c;
      cardContainer.innerHTML = createCardHTML(c);
      cardOverlay.style.display = "flex";
    }

    closeCardBtn.addEventListener("click", () => {
      cardOverlay.style.display = "none";
      currentCardClient = null;
    });
    cardOverlay.addEventListener("click", (e) => {
      if (e.target === cardOverlay) {
        cardOverlay.style.display = "none";
        currentCardClient = null;
      }
    });

    printCardBtn.addEventListener("click", () => {
      if (!currentCardClient) return;
      const cardHTML = `
        <html>
          <head>
            <title>OG Card ${currentCardClient.code}</title>
            <meta charset="UTF-8" />
            <style>
              body {
                margin:0;
                background:#000;
                display:flex;
                align-items:center;
                justify-content:center;
                min-height:100vh;
                font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
                color:#f9fafb;
              }
              .gold-card { ${getComputedStyle(cardContainer).cssText || ""} }
              ${document.querySelector("style").innerHTML}
            </style>
      </head>
      <body>
        <div class="gold-card">
          ${createCardHTML(currentCardClient)}
        </div>
        <script>
          window.onload = function(){
            window.print();
          };
        <\/script>
      </body>
    </html>
  `;
  const w = window.open("", "_blank");
  w.document.open();
  w.document.write(cardHTML);
  w.document.close();
});

function renderTable() {
  clientTableBody.innerHTML = "";
  const term = (searchInput.value || "").toLowerCase();
  const appFilter = filterApp.value;
  const contactFilter = filterContact.value;
  const ratingFilter = parseInt(filterRating.value || "0", 10);

  clients
    .slice()
    .sort((a, b) => a.code.localeCompare(b.code))
    .forEach((c) => {
      const textBlob =
        (c.name || "") +
        " " +
        (c.state || "") +
        " " +
        (c.city || "") +
        " " +
        (c.contactHandle || "") +
        " " +
        (c.sourceApp || "") +
        " " +
        (c.hobbies || "") +
        " " +
        (c.cryptoView || "");
      if (term && !textBlob.toLowerCase().includes(term)) return;
      if (appFilter && c.sourceApp !== appFilter) return;
      if (contactFilter === "pending" && c.contacted) return;
      if (contactFilter === "contacted" && !c.contacted) return;
      if (ratingFilter && (c.rating || 0) < ratingFilter) return;

      const tr = document.createElement("tr");

      const tdId = document.createElement("td");
      tdId.innerHTML = `<span class="id-pill">${c.code}</span>`;
      tr.appendChild(tdId);

      const tdClient = document.createElement("td");
      const locationLine =
        (c.city || "") || (c.state || "")
          ? `${c.city ? c.city : ""}${c.city && c.state ? ", " : ""}${c.state ? c.state : ""}`
          : "";
      tdClient.innerHTML = `
        <div>${c.name || "-"}</div>
        <div class="small">
          ${c.age ? c.age + " yrs" : ""}${
            c.age && (c.relationshipStatus || locationLine) ? " · " : ""
          }${c.relationshipStatus || ""}${
            (c.relationshipStatus && locationLine) || (c.age && locationLine) ? " · " : ""
          }${locationLine}
        </div>
      `;
      tr.appendChild(tdClient);

      const tdProfile = document.createElement("td");
      const looking = c.lookingFor ? `<span class="chip">${c.lookingFor}</span>` : "";
      const job =
        c.jobInfo || c.workStatus
          ? `<div class="small">${c.workStatus || ""}${c.jobInfo ? " · " + c.jobInfo : ""}</div>`
          : "";
      const hobby = c.hobbies ? `<div class="small">Hobby: ${c.hobbies}</div>` : "";
      const appearance = c.appearance
        ? `<div class="small">Appearance: ${c.appearance}</div>`
        : "";
      const crypto = c.cryptoView ? `<div class="small">Crypto: ${c.cryptoView}</div>` : "";
      const asian =
        c.asianExperience === "never"
          ? `<div class="small">Asia chat: never</div>`
          : c.asianExperience === "yes"
          ? `<div class="small">Asia chat: yes</div>`
          : "";
      tdProfile.innerHTML = `${looking || ""}${job}${hobby}${appearance}${crypto}${asian}`;
      tr.appendChild(tdProfile);

      const tdContact = document.createElement("td");
      const times =
        c.workStart || c.workEnd
          ? `<div class="small">Time: ${c.workStart || "?"} - ${c.workEnd || "?"}</div>`
          : "";
      tdContact.innerHTML = `
        <div>${c.contactApp || ""}</div>
        <div class="small">${c.contactHandle || ""}</div>
        ${times}
      `;
      tr.appendChild(tdContact);

      const tdSource = document.createElement("td");
      tdSource.textContent = c.sourceApp || "";
      tr.appendChild(tdSource);

      const tdContacted = document.createElement("td");
      const btnContacted = document.createElement("button");
      btnContacted.className =
        "contacted-toggle" + (c.contacted ? " active" : "");
      btnContacted.textContent = c.contacted ? "OG contacted" : "Pending";
      btnContacted.addEventListener("click", () => {
        c.contacted = !c.contacted;
        saveAll();
        renderTable();
      });
      tdContacted.appendChild(btnContacted);
      tr.appendChild(tdContacted);

      const tdRating = document.createElement("td");
      const ratingDiv = document.createElement("div");
      ratingDiv.className = "rating";
      for (let i = 1; i <= 5; i++) {
        const star = document.createElement("span");
        star.textContent = "★";
        if (i <= (c.rating || 0)) star.classList.add("active");
        star.addEventListener("click", () => {
          c.rating = i;
          saveAll();
          renderTable();
        });
        ratingDiv.appendChild(star);
      }
      tdRating.appendChild(ratingDiv);
      tr.appendChild(tdRating);

      const tdActions = document.createElement("td");
      tdActions.className = "actions";
      const editBtn = document.createElement("button");
      editBtn.className = "contacted-toggle";
      editBtn.textContent = "Edit";
      editBtn.addEventListener("click", () => {
        loadClientIntoForm(c.id);
      });
      tdActions.appendChild(editBtn);

      const cardBtn = document.createElement("button");
      cardBtn.className = "contacted-toggle";
      cardBtn.textContent = "Card";
      cardBtn.addEventListener("click", () => openCard(c));
      tdActions.appendChild(cardBtn);

      if (c.photo) {
        const img = document.createElement("img");
        img.src = c.photo;
        img.className = "photo-thumb";
        img.alt = "photo";
        tdActions.appendChild(img);
      }

      tr.appendChild(tdActions);
      clientTableBody.appendChild(tr);
    });
}

function loadClientIntoForm(id) {
  const c = findClient(id);
  if (!c) return;
  editingId = id;

  clientForm.clientName.value = c.name || "";
  clientForm.clientAge.value = c.age || "";
  clientForm.clientState.value = c.state || "";
  clientForm.clientCity.value = c.city || "";
  clientForm.relationshipStatus.value = c.relationshipStatus || "";
  clientForm.lookingFor.value = c.lookingFor || "";
  clientForm.workStatus.value = c.workStatus || "";
  workStatusSelect.dispatchEvent(new Event("change"));
  clientForm.jobInfo.value = c.jobInfo || "";
  clientForm.asianExperience.value = c.asianExperience || "";
  clientForm.cryptoView.value = c.cryptoView || "";
  clientForm.workStart.value = c.workStart || "";
  clientForm.workEnd.value = c.workEnd || "";
  clientForm.hobbies.value = c.hobbies || "";
  clientForm.appearance.value = c.appearance || "";
  clientForm.contactApp.value = c.contactApp || "";
  clientForm.contactHandle.value = c.contactHandle || "";
  clientForm.sourceApp.value = c.sourceApp || "";
  clientForm.notes.value = c.notes || "";
  photoInput.value = "";
  window.scrollTo({ top: 0, behavior: "smooth" });
}

searchInput.addEventListener("input", renderTable);
filterApp.addEventListener("change", renderTable);
filterContact.addEventListener("change", renderTable);
filterRating.addEventListener("change", renderTable);

function exportCSV() {
  if (!clients.length) {
    alert("No clients to export yet.");
    return;
  }
  const header = [
    "ID","Code","Name","Age","State","City",
    "RelationshipStatus","LookingFor","WorkStatus","JobInfo",
    "AsianExperience","CryptoView","WorkStart","WorkEnd",
    "Hobbies","Appearance","ContactApp","ContactHandle",
    "SourceApp","Contacted","Rating","Notes"
  ];
  const rows = clients.map(c => [
    c.id,
    c.code,
    `"${(c.name || "").replace(/"/g,'""')}"`,
    c.age || "",
    `"${(c.state || "").replace(/"/g,'""')}"`,
    `"${(c.city || "").replace(/"/g,'""')}"`,
    `"${(c.relationshipStatus || "").replace(/"/g,'""')}"`,
    `"${(c.lookingFor || "").replace(/"/g,'""')}"`,
    `"${(c.workStatus || "").replace(/"/g,'""')}"`,
    `"${(c.jobInfo || "").replace(/"/g,'""')}"`,
    c.asianExperience || "",
    `"${(c.cryptoView || "").replace(/"/g,'""')}"`,
    c.workStart || "",
    c.workEnd || "",
    `"${(c.hobbies || "").replace(/"/g,'""')}"`,
    `"${(c.appearance || "").replace(/"/g,'""')}"`,
    c.contactApp || "",
    `"${(c.contactHandle || "").replace(/"/g,'""')}"`,
    c.sourceApp || "",
    c.contacted ? "1" : "0",
    c.rating || 0,
    `"${(c.notes || "").replace(/"/g,'""')}"`,
  ].join(","));
  const csv = header.join(",") + "\n" + rows.join("\n");
  const blob = new Blob([csv], {type:"text/csv;charset=utf-8;"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "og_clients.csv";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

exportBtn.addEventListener("click", exportCSV);

saveAll();
renderTable();
updateLastSaved();

  </script>
</body>
</html>
